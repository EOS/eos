#!/usr/bin/env python3

from setuptools import setup, Extension
from glob import glob

try:
    from wheel.bdist_wheel import bdist_wheel as _bdist_wheel
    class bdist_wheel(_bdist_wheel):
        def finalize_options(self):
            _bdist_wheel.finalize_options(self)
            self.root_is_pure = False
except ImportError:
    bdist_wheel = None

setup(
    name='eoshep',
    version='@PYPI_VERSION@',
    description='EOS -- A HEP program for Flavor Observables',
    long_description=open('README.md').read(),
    long_description_content_type='text/markdown',
    classifiers=[
        'Intended Audience :: Science/Research',
        'License :: OSI Approved :: GNU General Public License v2 (GPLv2)',
        'Operating System :: POSIX :: Linux',
        'Programming Language :: C++',
        'Programming Language :: Python :: 3 :: Only',
        'Programming Language :: Python :: Implementation :: CPython',
        'Topic :: Scientific/Engineering :: Physics',
    ],
    author='Danny van Dyk and others',
    author_email='danny.van.dyk@gmail.com',
    url='https://eos.github.io/',
    license='GPLv2',
    install_requires=[
        'argcomplete', 'dynesty', 'matplotlib', 'numpy>=1.13', 'pypmc>=1.1.4', 'pyyaml', 'scipy'
    ],
    packages=['eos', 'eos.data', 'eos.plot', '_eos_data'],
    package_dir={
        '_eos_data': '_eos_data',
    },
    package_data={
        '_eos_data': [
            'references.yaml',
            'constraints/*.yaml',
            'parameters/*.yaml'
        ]
    },
    scripts=[
        'bin/eos-analysis',
        'bin/eos-data',
        'bin/eos-list-observables',
        'bin/eos-list-references',
    ],
    include_package_data=True,
    ext_modules=[
        Extension('_eos',
            extra_compile_args=['-std=c++20', '-O2'],
            extra_link_args=[
                '-leos', '-lboost_python@BOOST_PYTHON_SUFFIX@'
            ],
            sources=[
                '_eos.cc',
                '_eos/external-log-likelihood-block.cc',
                '_eos/log.cc',
                '_eos/version.cc',
                '_eos/wrappers.cc'
            ],
            include_dirs=['.', '../'],
            library_dirs=['@prefix@/lib'],
            runtime_library_dirs=['@prefix@/lib']
        )
    ],
    python_requires='>=3.10'
)
