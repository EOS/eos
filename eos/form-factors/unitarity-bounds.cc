/* vim: set sw=4 sts=4 tw=120 et foldmethod=syntax : */

/*
 * Copyright (c) 2019 Danny van Dyk
 *
 * This file is part of the EOS project. EOS is free software;
 * you can redistribute it and/or modify it under the terms of the GNU General
 * Public License version 2, as published by the Free Software Foundation.
 *
 * EOS is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA  02111-1307  USA
 */

#include <eos/form-factors/unitarity-bounds.hh>
#include <eos/utils/kinematic.hh>
#include <eos/utils/model.hh>
#include <eos/utils/options.hh>
#include <eos/utils/options-impl.hh>
#include <eos/utils/private_implementation_pattern-impl.hh>

#include <cmath>

#include <iostream>

namespace eos
{
    template <> struct Implementation<HQETUnitarityBounds>
    {
        // option to determine if we use z^3 terms in the leading-power IW function
        SwitchOption opt_zorder_bound;
        std::function<double ()> bound_0p;
        std::function<double ()> bound_0m;
        std::function<double ()> bound_1p;
        std::function<double ()> bound_1m;

        // parameters for the leading Isgur-Wise function xi
        UsedParameter xipone, xippone, xipppone;

        // parameters for the subleading Isgur-Wise function chi2
        UsedParameter chi2one, chi2pone, chi2ppone;

        // parameters for the subleading Isgur-Wise function chi3
        UsedParameter chi3pone, chi3ppone;

        // parameters for the subleading Isgur-Wise function eta
        UsedParameter etaone, etapone, etappone;

        // parameters for subsubleading 1/mc corrections in h+ (B->D), equal to delta{h+}
        UsedParameter l1one, l1pone, l1ppone;

        // parameters for subsubleading 1/mc corrections in hA1 (B->D^*), equal to delta{A1}
        UsedParameter l2one, l2pone, l2ppone;

        // parameters for subsubleading 1/m_c corrections
        UsedParameter l3one, l3pone, l3ppone;
        UsedParameter l4one, l4pone, l4ppone;
        UsedParameter l5one, l5pone, l5ppone;
        UsedParameter l6one, l6pone, l6ppone;

        Implementation(const Parameters & p, const Options & o, ParameterUser & u) :
            opt_zorder_bound(o, "z-order-bound", { "1", "2" }, "2"),
            xipone(p["B(*)->D(*)::xi'(1)@HQET"], u),
            xippone(p["B(*)->D(*)::xi''(1)@HQET"], u),
            xipppone(p["B(*)->D(*)::xi'''(1)@HQET"], u),
            chi2one(p["B(*)->D(*)::chi_2(1)@HQET"], u),
            chi2pone(p["B(*)->D(*)::chi_2'(1)@HQET"], u),
            chi2ppone(p["B(*)->D(*)::chi_2''(1)@HQET"], u),
            chi3pone(p["B(*)->D(*)::chi_3'(1)@HQET"], u),
            chi3ppone(p["B(*)->D(*)::chi_3''(1)@HQET"], u),
            etaone(p["B(*)->D(*)::eta(1)@HQET"], u),
            etapone(p["B(*)->D(*)::eta'(1)@HQET"], u),
            etappone(p["B(*)->D(*)::eta''(1)@HQET"], u),
            l1one(p["B(*)->D(*)::l_1(1)@HQET"], u),
            l1pone(p["B(*)->D(*)::l_1'(1)@HQET"], u),
            l1ppone(p["B(*)->D(*)::l_1''(1)@HQET"], u),
            l2one(p["B(*)->D(*)::l_2(1)@HQET"], u),
            l2pone(p["B(*)->D(*)::l_2'(1)@HQET"], u),
            l2ppone(p["B(*)->D(*)::l_2''(1)@HQET"], u),
            l3one(p["B(*)->D(*)::l_3(1)@HQET"], u),
            l3pone(p["B(*)->D(*)::l_3'(1)@HQET"], u),
            l3ppone(p["B(*)->D(*)::l_3''(1)@HQET"], u),
            l4one(p["B(*)->D(*)::l_4(1)@HQET"], u),
            l4pone(p["B(*)->D(*)::l_4'(1)@HQET"], u),
            l4ppone(p["B(*)->D(*)::l_4''(1)@HQET"], u),
            l5one(p["B(*)->D(*)::l_5(1)@HQET"], u),
            l5pone(p["B(*)->D(*)::l_5'(1)@HQET"], u),
            l5ppone(p["B(*)->D(*)::l_5''(1)@HQET"], u),
            l6one(p["B(*)->D(*)::l_6(1)@HQET"], u),
            l6pone(p["B(*)->D(*)::l_6'(1)@HQET"], u),
            l6ppone(p["B(*)->D(*)::l_6''(1)@HQET"], u)
        {
            if ("1" == opt_zorder_bound.value())
            {
                bound_0p = std::bind(&Implementation::bound_0p_z1, this);
                bound_0m = std::bind(&Implementation::bound_0m_z1, this);
                bound_1p = std::bind(&Implementation::bound_1p_z1, this);
                bound_1m = std::bind(&Implementation::bound_1m_z1, this);
            }
            else if ("2" == opt_zorder_bound.value())
            {
                bound_0p = std::bind(&Implementation::bound_0p_z2, this);
                bound_0m = std::bind(&Implementation::bound_0m_z2, this);
                bound_1p = std::bind(&Implementation::bound_1p_z2, this);
                bound_1m = std::bind(&Implementation::bound_1m_z2, this);
            }
            else
            {
                throw InternalError("Only z-order-bound=2 is presently supported");
            }
        }

        ~Implementation() = default;

        // bounds for z^1
        // {{{
        double bound_0p_z1() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.005825506071478239*pow(1.0202828226600784 + l1one*pow(0.17862041985779245,2),2) + 0.02239357695917938*pow(3.7960631929608732 - 3.7694897307095845*chi2one + 11.30846919212875*chi3pone - 1.079241959186295*etaone + 4.1630886290205975*xipone + 3.0639132699149516*l1one*pow(0.17862041985779245,2) + 4.080328058612812*l1pone*pow(0.17862041985779245,2) - 4.273014767654388*l4one*pow(0.17862041985779245,2) + 4.080328058612812*l1one*xipone*pow(0.17862041985779245,2),2),
                0.003907991070300332*pow(1.0202828226600784 + l2one*pow(0.17862041985779245,2),2) + 0.015022540138963305*pow(4.4411571545755715 - 3.7694897307095836*chi3pone + 4.163088629020597*xipone + 3.661246265806994*l2one*pow(0.17862041985779245,2) + 4.080328058612811*l2pone*pow(0.17862041985779245,2) - 4.514209096519603*l5one*pow(0.17862041985779245,2) + 4.080328058612811*l2one*xipone*pow(0.17862041985779245,2),2),
                0.001953995535150165*pow(1.0202828226600784 + l2one*pow(0.17862041985779245,2),2) + 0.007511270069481652*pow(4.4411571545755715 + 3.7694897307095836*chi2one - 3.7694897307095836*chi3pone + 1.1401607844615023*etaone + 4.163088629020597*xipone + 3.6612462658069944*l2one*pow(0.17862041985779245,2) + 4.080328058612811*l2pone*pow(0.17862041985779245,2) + 4.080328058612811*l3one*pow(0.17862041985779245,2) + 4.514209096519603*l5one*pow(0.17862041985779245,2) - 9.028418193039206*l6one*pow(0.17862041985779245,2) + 4.080328058612811*l2one*xipone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 0^+ unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                // add an r-fit like penalty
                static const double sigma2 = 0.71 / 5.69; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_0m_z1() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.000013370169715643602*pow(-14.589554481867248 - 2.87677798131995*etaone - 13.885806786446182*l2one*pow(0.17862041985779245,2) - 6.228003657868922*l5one*pow(0.17862041985779245,2) + 12.456007315737844*l6one*pow(0.17862041985779245,2),2) + 0.0008556908618011905*pow(-15.018331527084962 - 7.014319461064237*chi2one + 1.2006492771191013*chi3pone - 2.9854869275711917*etaone - 2.87677798131995*etapone - 14.58955448186725*xipone - 2.87677798131995*etaone*xipone - 14.410529734621102*l2one*pow(0.17862041985779245,2) - 13.885806786446183*l2pone*pow(0.17862041985779245,2) - 13.885806786446183*l3one*pow(0.17862041985779245,2) - 6.4633501876644415*l5one*pow(0.17862041985779245,2) - 6.228003657868922*l5pone*pow(0.17862041985779245,2) + 19.154704033197802*l6one*pow(0.17862041985779245,2) + 12.456007315737844*l6pone*pow(0.17862041985779245,2) - 13.885806786446183*l2one*xipone*pow(0.17862041985779245,2) - 6.228003657868922*l5one*xipone*pow(0.17862041985779245,2) + 12.456007315737844*l6one*xipone*pow(0.17862041985779245,2),2),
                0.000010987127164780628*pow(-22.542768943082773 + 4.736860339949285*etaone - 21.330476563405902*l1one*pow(0.17862041985779245,2) + 10.254939281231*l4one*pow(0.17862041985779245,2),2) + 0.0007031761385459613*pow(-21.000858213586017 + 10.774943017247953*chi2one - 41.255412453426835*chi3pone + 4.450737792419627*etaone + 4.736860339949281*etapone - 22.542768943082756*xipone + 4.736860339949281*etaone*xipone - 20.042042905594347*l1one*pow(0.17862041985779245,2) - 21.330476563405885*l1pone*pow(0.17862041985779245,2) + 9.635505913698111*l4one*pow(0.17862041985779245,2) + 10.25493928123099*l4pone*pow(0.17862041985779245,2) - 21.330476563405885*l1one*xipone*pow(0.17862041985779245,2) + 10.25493928123099*l4one*xipone*pow(0.17862041985779245,2),2),
                0.00001696879151553322*pow(-15.160927431638303 - 14.420644989449043*l2one*pow(0.17862041985779245,2) + 6.517305813227482*l5one*pow(0.17862041985779245,2),2) + 0.0010860026569941262*pow(-16.524484206009404 + 13.32208401312149*chi3pone - 15.160927431638303*xipone - 15.838121246690301*l2one*pow(0.17862041985779245,2) - 14.420644989449043*l2pone*pow(0.17862041985779245,2) + 7.1579239172158635*l5one*pow(0.17862041985779245,2) + 6.517305813227482*l5pone*pow(0.17862041985779245,2) - 14.420644989449043*l2one*xipone*pow(0.17862041985779245,2) + 6.517305813227482*l5one*xipone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 0^- unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                // add an r-fit like penalty
                static const double sigma2 = 0.06 / 1.46; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_1p_z1() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.0002634455263625299*pow(0.991277277263722 + l2one*pow(0.17862041985779245,2),2) + 0.000928214055953212*pow(-2.6516688130113835 - 1.1981904105019698*chi2one + 0.20509565585168876*chi3pone - 1.2214091420316235*etaone - 2.351292004199026*xipone - 2.3035098010173103*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) - 2.3719821468009723*l3one*pow(0.17862041985779245,2) - 2.6442571007294786*l5one*pow(0.17862041985779245,2) + 5.288514201458957*l6one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.04073136914413835*pow((0.6489910629304015 + 0.5345355636008995*xipone)*(0.991277277263722 + l2one*pow(0.17862041985779245,2)) + 0.06681694545011244*(0.10575297299349623 + 0.17862041985779245*(4 - 32*chi3pone) - 0.20933858123461027*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l2pone + l5one)*pow(0.17862041985779245,2)),2),
                0.0007223273260171127*pow(0.991277277263722 + l1one*pow(0.17862041985779245,2),2) + 0.00282838931341691*pow(-2.2883090307472784 + 1.1981904105019698*chi2one - 4.587665986156191*chi3pone + 1.1394791226254906*etaone - 2.351292004199026*xipone - 1.962434781465052*l1one*pow(0.17862041985779245,2) - 2.3719821468009723*l1pone*pow(0.17862041985779245,2) + 2.46688489339753*l4one*pow(0.17862041985779245,2) - 2.3719821468009723*l1one*xipone*pow(0.17862041985779245,2),2) + 0.037557428400381614*pow((0.9605471343811023 + 0.8984316559189242*xipone)*(0.991277277263722 + l1one*pow(0.17862041985779245,2)) + 0.11230395698986552*(0.10575297299349623 + 0.05233464530865257*(4 - 32*chi3pone) - 0.7144816794311698*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l1pone + l4one)*pow(0.17862041985779245,2)),2),
                0.0003411146306063143*pow(0.991277277263722 + l2one*pow(0.17862041985779245,2),2) + 0.0013320851299382112*pow(-3.3191424296845904 - 0.49654737732514054*chi2one + 2.1912851651522507*chi3pone - 0.12413684433128513*etaone - 2.351292004199026*xipone - 3.0403968018625096*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) + 1.1859910734004862*l5one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.0012160599192045114*pow(-2.8082191918340076 + 2.1912851651522507*chi3pone - 2.351292004199026*xipone - 2.464318307667692*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) + 2.624206492727772*l5one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.0013320851299382112*pow(-3.3191424296845904 - 1.6947377878271104*chi2one + 2.1912851651522507*chi3pone - 0.4236844469567776*etaone - 2.351292004199026*xipone - 3.0403968018625096*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) - 2.3719821468009723*l3one*pow(0.17862041985779245,2) - 1.1859910734004862*l5one*pow(0.17862041985779245,2) + 2.3719821468009723*l6one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 1^+ unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                static const double sigma2 = 0.34 / 3.63; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_1m_z1() const
        {
            const std::array<double, 4> weak_bounds
            {
                0.000026833571715836984*pow(2.8931829973663596 - 0.3266985044712808*etaone + 2.709143602528773*l1one*pow(0.17862041985779245,2) - 1.29348893665041*l4one*pow(0.17862041985779245,2),2) + 0.01629427297262482*pow(0.2808248548795206*(2.8931829973663596 - 0.3266985044712808*etaone + 2.709143602528773*l1one*pow(0.17862041985779245,2) - 1.29348893665041*l4one*pow(0.17862041985779245,2)) + 0.10993950423745151*(0.018875654107114767 - 7.39056208532624*(chi2one - 3*chi3pone) + 8*l1pone*pow(0.17862041985779245,2) + 8*xipone*(1.0050707056650197 + l1one*pow(0.17862041985779245,2)) - 0.47745307241854573*(0.0046441923535463685 + 2.0205723927862382*etapone + 8*l4pone*pow(0.17862041985779245,2) + 8*xipone*(-0.005375285858460568 + 0.05233464530865257*(1 - 2*etaone) + 0.17862041985779245*(-1 + 2*etaone) + l4one*pow(0.17862041985779245,2)))),2),
                0.00014635090217060402*pow(1.1974845539241097 + 0.05233464530865257*(1 - 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2),2) + 0.02754117923723504*pow((0.5793766430333188 + 0.5831716767309848*xipone)*(1.1974845539241097 + 0.05233464530865257*(1 - 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + 0.0728964595913731*(0.03218802151990908 - 5.715853435449358*chi3pone - 0.8373543249384411*(2*chi2one - 6*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)),2),
                0.00021525910443458962*pow(1.0711987793749698 + 0.17862041985779245*(1 - 2*etaone) + (l1one - l4one)*pow(0.17862041985779245,2),2) + 0.024885196861219643*pow((0.6843887459111011 + 0.744046728013827*xipone)*(1.0711987793749698 + 0.17862041985779245*(1 - 2*etaone) + (l1one - l4one)*pow(0.17862041985779245,2)) + 0.09300584100172837*(0.03218802151990908 - 1.6747086498768822*chi3pone - 2.857926717724679*(2*chi2one - 6*chi3pone + etapone) + 8*(l1pone - l4pone)*pow(0.17862041985779245,2)),2),
                0.00011131839343464602*pow(1.1974845539241097 + 0.05233464530865257*(1 + 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2),2) + 0.000018381891618232285*pow(2.9368143497470225 + 2.758675717499152*l2one*pow(0.17862041985779245,2) - 1.2467634633278375*l5one*pow(0.17862041985779245,2),2) + 0.00011131839343464602*pow(1.0711987793749698 + 0.17862041985779245*(1 + 2*etaone) + (l2one + l5one - 2*l6one)*pow(0.17862041985779245,2),2) + 9.190945809116143e-6*pow(2.9368143497470225 + 0.31489697929184823*etaone + 2.758675717499152*l2one*pow(0.17862041985779245,2) + 1.2467634633278375*l5one*pow(0.17862041985779245,2) - 2.493526926655675*l6one*pow(0.17862041985779245,2),2) + 0.0011764410635668663*pow(3.0633889658297986 - 2.548520520432424*chi3pone + 2.9368143497470225*xipone + 2.872138398363049*l2one*pow(0.17862041985779245,2) + 2.758675717499152*l2pone*pow(0.17862041985779245,2) - 1.298042098237697*l5one*pow(0.17862041985779245,2) - 1.2467634633278375*l5pone*pow(0.17862041985779245,2) + 2.758675717499152*l2one*xipone*pow(0.17862041985779245,2) - 1.2467634633278375*l5one*xipone*pow(0.17862041985779245,2),2) + 0.0005882205317834331*pow(3.0633889658297995 + 2.548520520432424*chi2one - 2.548520520432424*chi3pone + 0.32784850354667666*etaone + 0.31489697929184823*etapone + 2.936814349747022*xipone + 0.31489697929184823*etaone*xipone + 2.8721383983630497*l2one*pow(0.17862041985779245,2) + 2.7586757174991514*l2pone*pow(0.17862041985779245,2) + 2.7586757174991514*l3one*pow(0.17862041985779245,2) + 1.298042098237697*l5one*pow(0.17862041985779245,2) + 1.2467634633278375*l5pone*pow(0.17862041985779245,2) - 3.842847659803231*l6one*pow(0.17862041985779245,2) - 2.493526926655675*l6pone*pow(0.17862041985779245,2) + 2.7586757174991514*l2one*xipone*pow(0.17862041985779245,2) + 1.2467634633278375*l5one*xipone*pow(0.17862041985779245,2) - 2.493526926655675*l6one*xipone*pow(0.17862041985779245,2),2) + 0.027261049494251476*pow((0.5322392241805594 + 0.5112133261002769*xipone)*(1.1974845539241097 + 0.05233464530865257*(1 + 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + 0.06390166576253462*(0.03218802151990908 - 5.715853435449358*chi3pone + 0.8373543249384411*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)),2) + 0.027261049494251476*pow((0.5322392241805594 + 0.5112133261002769*xipone)*(1.0711987793749698 + 0.17862041985779245*(1 + 2*etaone) + (l2one + l5one - 2*l6one)*pow(0.17862041985779245,2)) + 0.06390166576253462*(0.03218802151990908 - 1.6747086498768822*chi3pone + 2.857926717724679*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone + l3one + l5pone - l6one - 2*l6pone)*pow(0.17862041985779245,2)),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 1^- unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                static const double sigma2 = 0.51 / 3.73; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }
        // }}}

        // bounds for z^2
        // {{{
        double bound_0p_z2() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.005825506071478239*pow(1.0202828226600784 + l1one*pow(0.17862041985779245,2),2) + 0.02239357695917938*pow(3.7960631929608732 - 3.7694897307095845*chi2one + 11.30846919212875*chi3pone - 1.079241959186295*etaone + 4.1630886290205975*xipone + 3.0639132699149516*l1one*pow(0.17862041985779245,2) + 4.080328058612812*l1pone*pow(0.17862041985779245,2) - 4.273014767654388*l4one*pow(0.17862041985779245,2) + 4.080328058612812*l1one*xipone*pow(0.17862041985779245,2),2) + 9.512806173691782*pow(0.46178428683285777 - 1.464435042228163*chi2one - 1.4631200519251466*chi2pone + 4.393305126684489*chi3pone + 2.19468007788772*chi3ppone - 0.20982932038503554*etaone - 0.41890565147320336*etapone + 1.8774081624648098*xipone - 1.4631200519251466*chi2one*xipone + 4.38936015577544*chi3pone*xipone - 0.41890565147320336*etaone*xipone + 0.8079473464854074*xippone + 0.3429387254012637*l1one*pow(0.17862041985779245,2) + 1.5851947663204224*l1pone*pow(0.17862041985779245,2) + 0.7918856698762501*l1ppone*pow(0.17862041985779245,2) - 0.8307717996510663*l4one*pow(0.17862041985779245,2) - 1.658562308259828*l4pone*pow(0.17862041985779245,2) + 1.5851947663204224*l1one*xipone*pow(0.17862041985779245,2) + 1.5837713397525002*l1pone*xipone*pow(0.17862041985779245,2) - 1.658562308259828*l4one*xipone*pow(0.17862041985779245,2) + 0.7918856698762501*l1one*xippone*pow(0.17862041985779245,2),2),
                0.003907991070300332*pow(1.0202828226600784 + l2one*pow(0.17862041985779245,2),2) + 0.015022540138963305*pow(4.4411571545755715 - 3.7694897307095836*chi3pone + 4.163088629020597*xipone + 3.661246265806994*l2one*pow(0.17862041985779245,2) + 4.080328058612811*l2pone*pow(0.17862041985779245,2) - 4.514209096519603*l5one*pow(0.17862041985779245,2) + 4.080328058612811*l2one*xipone*pow(0.17862041985779245,2),2) + 7.459264833117849*pow(0.6067183794144908 - 1.552638104270772*chi3pone - 0.6766533387725426*chi3ppone + 1.968099682853922*xipone - 1.3533066775450853*chi3pone*xipone + 0.7473074664412248*xippone + 0.450786848478118*l2one*pow(0.17862041985779245,2) + 1.6806711980443194*l2pone*pow(0.17862041985779245,2) + 0.732451286882246*l2ppone*pow(0.17862041985779245,2) - 1.0490487252449183*l5one*pow(0.17862041985779245,2) - 1.6206727569475938*l5pone*pow(0.17862041985779245,2) + 1.6806711980443194*l2one*xipone*pow(0.17862041985779245,2) + 1.464902573764492*l2pone*xipone*pow(0.17862041985779245,2) - 1.6206727569475938*l5one*xipone*pow(0.17862041985779245,2) + 0.732451286882246*l2one*xippone*pow(0.17862041985779245,2),2),
                0.001953995535150165*pow(1.0202828226600784 + l2one*pow(0.17862041985779245,2),2) + 0.007511270069481652*pow(4.4411571545755715 + 3.7694897307095836*chi2one - 3.7694897307095836*chi3pone + 1.1401607844615023*etaone + 4.163088629020597*xipone + 3.6612462658069944*l2one*pow(0.17862041985779245,2) + 4.080328058612811*l2pone*pow(0.17862041985779245,2) + 4.080328058612811*l3one*pow(0.17862041985779245,2) + 4.514209096519603*l5one*pow(0.17862041985779245,2) - 9.028418193039206*l6one*pow(0.17862041985779245,2) + 4.080328058612811*l2one*xipone*pow(0.17862041985779245,2),2) + 3.7296324165589234*pow(0.606718379414491 + 1.5526381042707718*chi2one + 1.3533066775450853*chi2pone - 1.5526381042707718*chi3pone - 0.6766533387725426*chi3ppone + 0.26495986161468477*etaone + 0.4093358288036335*etapone + 1.9680996828539215*xipone + 1.3533066775450853*chi2one*xipone - 1.3533066775450853*chi3pone*xipone + 0.4093358288036335*etaone*xipone + 0.7473074664412248*xippone + 0.4507868484781181*l2one*pow(0.17862041985779245,2) + 1.680671198044319*l2pone*pow(0.17862041985779245,2) + 0.732451286882246*l2ppone*pow(0.17862041985779245,2) + 1.680671198044319*l3one*pow(0.17862041985779245,2) + 1.464902573764492*l3pone*pow(0.17862041985779245,2) + 1.0490487252449179*l5one*pow(0.17862041985779245,2) + 1.6206727569475932*l5pone*pow(0.17862041985779245,2) - 3.71877020743743*l6one*pow(0.17862041985779245,2) - 3.2413455138951868*l6pone*pow(0.17862041985779245,2) + 1.680671198044319*l2one*xipone*pow(0.17862041985779245,2) + 1.464902573764492*l2pone*xipone*pow(0.17862041985779245,2) + 1.464902573764492*l3one*xipone*pow(0.17862041985779245,2) + 1.6206727569475932*l5one*xipone*pow(0.17862041985779245,2) - 3.2413455138951868*l6one*xipone*pow(0.17862041985779245,2) + 0.732451286882246*l2one*xippone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 0^+ unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                // add an r-fit like penalty
                static const double sigma2 = 0.71 / 5.69; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_0m_z2() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.000013370169715643602*pow(-14.589554481867248 - 2.87677798131995*etaone - 13.885806786446182*l2one*pow(0.17862041985779245,2) - 6.228003657868922*l5one*pow(0.17862041985779245,2) + 12.456007315737844*l6one*pow(0.17862041985779245,2),2) + 0.0008556908618011905*pow(-15.018331527084962 - 7.014319461064237*chi2one + 1.2006492771191013*chi3pone - 2.9854869275711917*etaone - 2.87677798131995*etapone - 14.58955448186725*xipone - 2.87677798131995*etaone*xipone - 14.410529734621102*l2one*pow(0.17862041985779245,2) - 13.885806786446183*l2pone*pow(0.17862041985779245,2) - 13.885806786446183*l3one*pow(0.17862041985779245,2) - 6.4633501876644415*l5one*pow(0.17862041985779245,2) - 6.228003657868922*l5pone*pow(0.17862041985779245,2) + 19.154704033197802*l6one*pow(0.17862041985779245,2) + 12.456007315737844*l6pone*pow(0.17862041985779245,2) - 13.885806786446183*l2one*xipone*pow(0.17862041985779245,2) - 6.228003657868922*l5one*xipone*pow(0.17862041985779245,2) + 12.456007315737844*l6one*xipone*pow(0.17862041985779245,2),2) + 0.41972667705238187*pow(-1.8919137818362883 - 3.262835738928141*chi2one - 2.5336737330201107*chi2pone + 0.558503414771482*chi3pone + 0.21684595012334307*chi3ppone - 0.39508522967973403*etaone - 1.3381845612415462*etapone - 0.5195669264467098*etappone - 6.742328333956542*xipone - 2.5336737330201107*chi2one*xipone + 0.43369190024668614*chi3pone*xipone - 1.3381845612415462*etaone*xipone - 1.0391338528934195*etapone*xipone - 2.6349791431914906*xippone - 0.5195669264467098*etaone*xippone - 1.9070213965536285*l2one*pow(0.17862041985779245,2) - 6.4592305637293235*l2pone*pow(0.17862041985779245,2) - 2.507877215452141*l2ppone*pow(0.17862041985779245,2) - 6.4592305637293235*l3one*pow(0.17862041985779245,2) - 5.015754430904282*l3pone*pow(0.17862041985779245,2) - 0.8553292160858292*l5one*pow(0.17862041985779245,2) - 2.897066925718086*l5pone*pow(0.17862041985779245,2) - 1.124822540852844*l5ppone*pow(0.17862041985779245,2) + 4.607725357889744*l6one*pow(0.17862041985779245,2) + 8.04377893314186*l6pone*pow(0.17862041985779245,2) + 2.249645081705688*l6ppone*pow(0.17862041985779245,2) - 6.4592305637293235*l2one*xipone*pow(0.17862041985779245,2) - 5.015754430904282*l2pone*xipone*pow(0.17862041985779245,2) - 5.015754430904282*l3one*xipone*pow(0.17862041985779245,2) - 2.897066925718086*l5one*xipone*pow(0.17862041985779245,2) - 2.249645081705688*l5pone*xipone*pow(0.17862041985779245,2) + 8.04377893314186*l6one*xipone*pow(0.17862041985779245,2) + 4.499290163411376*l6pone*xipone*pow(0.17862041985779245,2) - 2.507877215452141*l2one*xippone*pow(0.17862041985779245,2) - 1.124822540852844*l5one*xippone*pow(0.17862041985779245,2) + 2.249645081705688*l6one*xippone*pow(0.17862041985779245,2),2),
                0.000010987127164780628*pow(-22.542768943082773 + 4.736860339949285*etaone - 21.330476563405902*l1one*pow(0.17862041985779245,2) + 10.254939281231*l4one*pow(0.17862041985779245,2),2) + 0.0007031761385459613*pow(-21.000858213586017 + 10.774943017247953*chi2one - 41.255412453426835*chi3pone + 4.450737792419627*etaone + 4.736860339949281*etapone - 22.542768943082756*xipone + 4.736860339949281*etaone*xipone - 20.042042905594347*l1one*pow(0.17862041985779245,2) - 21.330476563405885*l1pone*pow(0.17862041985779245,2) + 9.635505913698111*l4one*pow(0.17862041985779245,2) + 10.25493928123099*l4pone*pow(0.17862041985779245,2) - 21.330476563405885*l1one*xipone*pow(0.17862041985779245,2) + 10.25493928123099*l4one*xipone*pow(0.17862041985779245,2),2) + 0.5103614048190293*pow(-1.9013257520523974 + 3.8062545380943758*chi2one + 3.199617912962564*chi2pone - 14.573497105316303*chi3pone - 6.1253946531941*chi3ppone + 0.42752372134378364*etaone + 1.6732985164181606*etapone + 0.7033050277223054*etappone - 7.909720155444564*xipone + 3.199617912962564*chi2one*xipone - 12.2507893063882*chi3pone*xipone + 1.6732985164181606*etaone*xipone + 1.4066100554446108*etapone*xipone - 3.3470361375742184*xippone + 0.7033050277223054*etaone*xippone - 1.9251749183978024*l1one*pow(0.17862041985779245,2) - 7.535002560033591*l1pone*pow(0.17862041985779245,2) - 3.1670411061595263*l1ppone*pow(0.17862041985779245,2) + 0.925556062248895*l4one*pow(0.17862041985779245,2) + 3.622562932777087*l4pone*pow(0.17862041985779245,2) + 1.5226014359447941*l4ppone*pow(0.17862041985779245,2) - 7.535002560033591*l1one*xipone*pow(0.17862041985779245,2) - 6.3340822123190526*l1pone*xipone*pow(0.17862041985779245,2) + 3.622562932777087*l4one*xipone*pow(0.17862041985779245,2) + 3.0452028718895883*l4pone*xipone*pow(0.17862041985779245,2) - 3.1670411061595263*l1one*xippone*pow(0.17862041985779245,2) + 1.5226014359447941*l4one*xippone*pow(0.17862041985779245,2),2),
                0.00001696879151553322*pow(-15.160927431638303 - 14.420644989449043*l2one*pow(0.17862041985779245,2) + 6.517305813227482*l5one*pow(0.17862041985779245,2),2) + 0.0010860026569941262*pow(-16.524484206009404 + 13.32208401312149*chi3pone - 15.160927431638303*xipone - 15.838121246690301*l2one*pow(0.17862041985779245,2) - 14.420644989449043*l2pone*pow(0.17862041985779245,2) + 7.1579239172158635*l5one*pow(0.17862041985779245,2) + 6.517305813227482*l5pone*pow(0.17862041985779245,2) - 14.420644989449043*l2one*xipone*pow(0.17862041985779245,2) + 6.517305813227482*l5one*xipone*pow(0.17862041985779245,2),2) + 0.5761118796300714*pow(-2.150466711686959 + 6.238915224726561*chi3pone + 2.3136314972168615*chi3ppone - 7.0560682392045*xipone + 4.627262994433723*chi3pone*xipone - 2.63298138626876*xippone - 2.153940696644513*l2one*pow(0.17862041985779245,2) - 6.753386443625182*l2pone*pow(0.17862041985779245,2) - 2.5044173587938743*l2ppone*pow(0.17862041985779245,2) + 0.9734578608557002*l5one*pow(0.17862041985779245,2) + 3.0521439755443054*l5pone*pow(0.17862041985779245,2) + 1.1318532439538778*l5ppone*pow(0.17862041985779245,2) - 6.753386443625182*l2one*xipone*pow(0.17862041985779245,2) - 5.008834717587749*l2pone*xipone*pow(0.17862041985779245,2) + 3.0521439755443054*l5one*xipone*pow(0.17862041985779245,2) + 2.2637064879077555*l5pone*xipone*pow(0.17862041985779245,2) - 2.5044173587938743*l2one*xippone*pow(0.17862041985779245,2) + 1.1318532439538778*l5one*xippone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 0^- unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                static const double sigma2 = 0.06 / 1.46; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_1p_z2() const
        {
            const std::array<double, 3> weak_bounds
            {
                0.0002634455263625299*pow(0.991277277263722 + l2one*pow(0.17862041985779245,2),2) + 0.000928214055953212*pow(-2.6516688130113835 - 1.1981904105019698*chi2one + 0.20509565585168876*chi3pone - 1.2214091420316235*etaone - 2.351292004199026*xipone - 2.3035098010173103*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) - 2.3719821468009723*l3one*pow(0.17862041985779245,2) - 2.6442571007294786*l5one*pow(0.17862041985779245,2) + 5.288514201458957*l6one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.011376860803770166*pow(2.359367355699374 + 3.34342504835947*chi2one + 2.7379699324583706*chi2pone - 0.5722979812507223*chi3pone - 0.23433075998517627*chi3ppone + 2.0127011079126262*etaone + 2.7910267656969054*etapone + 7.402522258234885*xipone + 2.7379699324583706*chi2one*xipone - 0.46866151997035255*chi3pone*xipone + 2.7910267656969054*etaone*xipone + 2.68645398657033*xippone + 1.7734568392678665*l2one*pow(0.17862041985779245,2) + 6.61876814767147*l2pone*pow(0.17862041985779245,2) + 2.7100933797109716*l2ppone*pow(0.17862041985779245,2) + 6.61876814767147*l3one*pow(0.17862041985779245,2) + 5.420186759421943*l3pone*pow(0.17862041985779245,2) + 4.357343508491814*l5one*pow(0.17862041985779245,2) + 6.042358853843418*l5pone*pow(0.17862041985779245,2) - 14.757045870827046*l6one*pow(0.17862041985779245,2) - 12.084717707686837*l6pone*pow(0.17862041985779245,2) + 6.61876814767147*l2one*xipone*pow(0.17862041985779245,2) + 5.420186759421943*l2pone*xipone*pow(0.17862041985779245,2) + 5.420186759421943*l3one*xipone*pow(0.17862041985779245,2) + 6.042358853843418*l5one*xipone*pow(0.17862041985779245,2) - 12.084717707686837*l6one*xipone*pow(0.17862041985779245,2) + 2.7100933797109716*l2one*xippone*pow(0.17862041985779245,2),2) + 0.04073136914413835*pow((0.6489910629304015 + 0.5345355636008995*xipone)*(0.991277277263722 + l2one*pow(0.17862041985779245,2)) + 0.06681694545011244*(0.10575297299349623 + 0.17862041985779245*(4 - 32*chi3pone) - 0.20933858123461027*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l2pone + l5one)*pow(0.17862041985779245,2)),2) + 0.04073136914413835*pow((2.5344087280025343 + 5.191928503443212*xipone + 0.06681694545011244*(16*xipone + 32*xippone))*(0.991277277263722 + l2one*pow(0.17862041985779245,2)) + (0.6489910629304015 + 0.5345355636008995*xipone)*(0.10575297299349623 + 0.17862041985779245*(4 - 32*chi3pone) - 0.20933858123461027*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l2pone + l5one)*pow(0.17862041985779245,2)) + 0.06681694545011244*(-0.2734259911890646 + 0.17862041985779245*(-8 - 64*(chi3pone + 2*chi3ppone)) + 0.41867716246922054*(-1 - 8*chi2one - 32*chi2pone + 24*chi3pone + 48*chi3ppone + 2*etaone - 8*etapone) + 8*(2*l2pone + 4*l2ppone + l5one - 4*l5pone)*pow(0.17862041985779245,2)),2),
                0.0007223273260171127*pow(0.991277277263722 + l1one*pow(0.17862041985779245,2),2) + 0.00282838931341691*pow(-2.2883090307472784 + 1.1981904105019698*chi2one - 4.587665986156191*chi3pone + 1.1394791226254906*etaone - 2.351292004199026*xipone - 1.962434781465052*l1one*pow(0.17862041985779245,2) - 2.3719821468009723*l1pone*pow(0.17862041985779245,2) + 2.46688489339753*l4one*pow(0.17862041985779245,2) - 2.3719821468009723*l1one*xipone*pow(0.17862041985779245,2),2) + 0.03555160950637785*pow(1.6374553315940936 - 2.912784895881712*chi2one - 2.7036831023682186*chi2pone + 11.152554781529078*chi3pone + 5.1759699031824*chi3ppone - 1.4844571758331553*etaone - 2.5712027256613053*etapone + 6.489911375014158*xipone - 2.7036831023682186*chi2one*xipone + 10.3519398063648*chi3pone*xipone - 2.5712027256613053*etaone*xipone + 2.6528122762321*xippone + 1.2076947902829935*l1one*pow(0.17862041985779245,2) + 5.766256940421067*l1pone*pow(0.17862041985779245,2) + 2.6761556398778814*l1ppone*pow(0.17862041985779245,2) - 3.2137359160391976*l4one*pow(0.17862041985779245,2) - 5.566456669413783*l4pone*pow(0.17862041985779245,2) + 5.766256940421067*l1one*xipone*pow(0.17862041985779245,2) + 5.352311279755763*l1pone*xipone*pow(0.17862041985779245,2) - 5.566456669413783*l4one*xipone*pow(0.17862041985779245,2) + 2.6761556398778814*l1one*xippone*pow(0.17862041985779245,2),2) + 0.037557428400381614*pow((0.9605471343811023 + 0.8984316559189242*xipone)*(0.991277277263722 + l1one*pow(0.17862041985779245,2)) + 0.11230395698986552*(0.10575297299349623 + 0.05233464530865257*(4 - 32*chi3pone) - 0.7144816794311698*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l1pone + l4one)*pow(0.17862041985779245,2)),2) + 0.037557428400381614*pow((3.2694898363708664 + 7.684377075048818*xipone + 0.11230395698986552*(16*xipone + 32*xippone))*(0.991277277263722 + l1one*pow(0.17862041985779245,2)) + (0.9605471343811023 + 0.8984316559189242*xipone)*(0.10575297299349623 + 0.05233464530865257*(4 - 32*chi3pone) - 0.7144816794311698*(-1 + 8*chi2one - 24*chi3pone + 2*etaone) - 4*(-2*l1pone + l4one)*pow(0.17862041985779245,2)) + 0.11230395698986552*(-0.2734259911890646 + 0.05233464530865257*(-8 - 64*(chi3pone + 2*chi3ppone)) + 1.4289633588623396*(-1 - 8*chi2one - 32*chi2pone + 24*chi3pone + 48*chi3ppone + 2*etaone - 8*etapone) + 8*(2*l1pone + 4*l1ppone + l4one - 4*l4pone)*pow(0.17862041985779245,2)),2),
                0.0003411146306063143*pow(0.991277277263722 + l2one*pow(0.17862041985779245,2),2) + 0.0013320851299382112*pow(-3.3191424296845904 - 0.49654737732514054*chi2one + 2.1912851651522507*chi3pone - 0.12413684433128513*etaone - 2.351292004199026*xipone - 3.0403968018625096*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) + 1.1859910734004862*l5one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.0012160599192045114*pow(-2.8082191918340076 + 2.1912851651522507*chi3pone - 2.351292004199026*xipone - 2.464318307667692*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) + 2.624206492727772*l5one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.0013320851299382112*pow(-3.3191424296845904 - 1.6947377878271104*chi2one + 2.1912851651522507*chi3pone - 0.4236844469567776*etaone - 2.351292004199026*xipone - 3.0403968018625096*l2one*pow(0.17862041985779245,2) - 2.3719821468009723*l2pone*pow(0.17862041985779245,2) - 2.3719821468009723*l3one*pow(0.17862041985779245,2) - 1.1859910734004862*l5one*pow(0.17862041985779245,2) + 2.3719821468009723*l6one*pow(0.17862041985779245,2) - 2.3719821468009723*l2one*xipone*pow(0.17862041985779245,2),2) + 0.000022691862656867035*pow(-114.65942513118152 - 159.11982675499104*chi2one - 103.87796117118494*chi2pone + 205.74092249212217*chi3pone + 67.15677107563866*chi3ppone - 26.79521154234964*etaone - 25.969490292796234*etapone - 239.47516024371967*xipone - 103.87796117118494*chi2one*xipone + 134.31354215127732*chi3pone*xipone - 25.969490292796234*etaone*xipone - 72.0605338680337*xippone - 96.3343409076641*l2one*pow(0.17862041985779245,2) - 222.70665761741193*l2pone*pow(0.17862041985779245,2) - 72.69462896087603*l2ppone*pow(0.17862041985779245,2) - 222.70665761741193*l3one*pow(0.17862041985779245,2) - 145.38925792175206*l3pone*pow(0.17862041985779245,2) - 75.00601432826797*l5one*pow(0.17862041985779245,2) - 72.69462896087603*l5pone*pow(0.17862041985779245,2) + 222.70665761741193*l6one*pow(0.17862041985779245,2) + 145.38925792175206*l6pone*pow(0.17862041985779245,2) - 222.70665761741193*l2one*xipone*pow(0.17862041985779245,2) - 145.38925792175206*l2pone*xipone*pow(0.17862041985779245,2) - 145.38925792175206*l3one*xipone*pow(0.17862041985779245,2) - 72.69462896087603*l5one*xipone*pow(0.17862041985779245,2) + 145.38925792175206*l6one*xipone*pow(0.17862041985779245,2) - 72.69462896087603*l2one*xippone*pow(0.17862041985779245,2),2) + 0.00002269186265686789*pow(-114.65942513117935 - 46.62109573713025*chi2one - 30.435580980091824*chi2pone + 205.74092249211827*chi3pone + 67.15677107563741*chi3ppone - 7.850826311771085*etaone - 7.608895245022956*etapone - 239.47516024371515*xipone - 30.435580980091824*chi2one*xipone + 134.31354215127482*chi3pone*xipone - 7.608895245022956*etaone*xipone - 72.06053386803235*xippone - 96.3343409076623*l2one*pow(0.17862041985779245,2) - 222.70665761740776*l2pone*pow(0.17862041985779245,2) - 72.69462896087467*l2ppone*pow(0.17862041985779245,2) + 75.00601432826656*l5one*pow(0.17862041985779245,2) + 72.69462896087467*l5pone*pow(0.17862041985779245,2) - 222.70665761740776*l2one*xipone*pow(0.17862041985779245,2) - 145.38925792174933*l2pone*xipone*pow(0.17862041985779245,2) + 72.69462896087467*l5one*xipone*pow(0.17862041985779245,2) - 72.69462896087467*l2one*xippone*pow(0.17862041985779245,2),2) + 0.009763964568486045*pow(3.334913366707285 - 7.974103760815025*chi3pone - 3.0933088194781115*chi3ppone + 9.58798739080337*xipone - 6.186617638956223*chi3pone*xipone + 3.3191810949223775*xippone + 2.5501773438200552*l2one*pow(0.17862041985779245,2) + 8.631661482579128*l2pone*pow(0.17862041985779245,2) + 3.3483881564243037*l2ppone*pow(0.17862041985779245,2) - 5.845069358574001*l5one*pow(0.17862041985779245,2) - 7.408876961499929*l5pone*pow(0.17862041985779245,2) + 8.631661482579128*l2one*xipone*pow(0.17862041985779245,2) + 6.696776312848607*l2pone*xipone*pow(0.17862041985779245,2) - 7.408876961499929*l5one*xipone*pow(0.17862041985779245,2) + 3.3483881564243037*l2one*xippone*pow(0.17862041985779245,2),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 1^+ unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                static const double sigma2 = 0.34 / 3.63; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }

        double bound_1m_z2() const
        {
            const std::array<double, 4> weak_bounds
            {
                0.000026833571715836984*pow(2.8931829973663596 - 0.3266985044712808*etaone + 2.709143602528773*l1one*pow(0.17862041985779245,2) - 1.29348893665041*l4one*pow(0.17862041985779245,2),2) + 0.21164551686463315*pow(0.4867196003707655 - 2.011013700418337*chi2one - 1.8035749218173378*chi2pone + 6.0330411012550105*chi3pone + 2.7053623827260065*chi3ppone - 0.05522452919547619*etaone - 0.26250807478669486*etapone - 0.11771500620839734*etappone + 2.3287893803474016*xipone - 1.8035749218173378*chi2one*xipone + 5.410724765452013*chi3pone*xipone - 0.26250807478669486*etaone*xipone - 0.23543001241679468*etapone*xipone + 1.0424628513319358*xippone - 0.11771500620839734*etaone*xippone + 0.45794877517028776*l1one*pow(0.17862041985779245,2) + 2.176845200352108*l1pone*pow(0.17862041985779245,2) + 0.976150339308176*l1ppone*pow(0.17862041985779245,2) - 0.21864904971536367*l4one*pow(0.17862041985779245,2) - 1.0393414290876786*l4pone*pow(0.17862041985779245,2) - 0.4660659786450945*l4ppone*pow(0.17862041985779245,2) + 2.176845200352108*l1one*xipone*pow(0.17862041985779245,2) + 1.952300678616352*l1pone*xipone*pow(0.17862041985779245,2) - 1.0393414290876786*l4one*xipone*pow(0.17862041985779245,2) - 0.932131957290189*l4pone*xipone*pow(0.17862041985779245,2) + 0.976150339308176*l1one*xippone*pow(0.17862041985779245,2) - 0.4660659786450945*l4one*xippone*pow(0.17862041985779245,2),2) + 0.01629427297262482*pow(0.2808248548795206*(2.8931829973663596 - 0.3266985044712808*etaone + 2.709143602528773*l1one*pow(0.17862041985779245,2) - 1.29348893665041*l4one*pow(0.17862041985779245,2)) + 0.10993950423745151*(0.018875654107114767 - 7.39056208532624*(chi2one - 3*chi3pone) + 8*l1pone*pow(0.17862041985779245,2) + 8*xipone*(1.0050707056650197 + l1one*pow(0.17862041985779245,2)) - 0.47745307241854573*(0.0046441923535463685 + 2.0205723927862382*etapone + 8*l4pone*pow(0.17862041985779245,2) + 8*xipone*(-0.005375285858460568 + 0.05233464530865257*(1 - 2*etaone) + 0.17862041985779245*(-1 + 2*etaone) + l4one*pow(0.17862041985779245,2)))),2),
                0.00014635090217060402*pow(1.1974845539241097 + 0.05233464530865257*(1 - 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2),2) + 0.02754117923723504*pow((0.5793766430333188 + 0.5831716767309848*xipone)*(1.1974845539241097 + 0.05233464530865257*(1 - 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + 0.0728964595913731*(0.03218802151990908 - 5.715853435449358*chi3pone - 0.8373543249384411*(2*chi2one - 6*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)),2) + 0.02754117923723504*pow((1.4999940008253256 + 4.6350131442665505*xipone + 0.0728964595913731*(16*xipone + 32*xippone))*(1.1974845539241097 + 0.05233464530865257*(1 - 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + (0.5793766430333188 + 0.5831716767309848*xipone)*(0.03218802151990908 - 5.715853435449358*chi3pone - 0.8373543249384411*(2*chi2one - 6*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)) + 0.0728964595913731*(-0.1851480494207603 - 11.431706870898717*(chi3pone + 2*chi3ppone) - 1.6747086498768822*(2*chi2one + 8*chi2pone - 6*chi3pone - 12*chi3ppone + etapone + 2*etappone) + 16*(l2pone + 2*l2ppone - l5pone - 2*l5ppone)*pow(0.17862041985779245,2)),2),
                0.00021525910443458962*pow(1.0711987793749698 + 0.17862041985779245*(1 - 2*etaone) + (l1one - l4one)*pow(0.17862041985779245,2),2) + 0.024885196861219643*pow((0.6843887459111011 + 0.744046728013827*xipone)*(1.0711987793749698 + 0.17862041985779245*(1 - 2*etaone) + (l1one - l4one)*pow(0.17862041985779245,2)) + 0.09300584100172837*(0.03218802151990908 - 1.6747086498768822*chi3pone - 2.857926717724679*(2*chi2one - 6*chi3pone + etapone) + 8*(l1pone - l4pone)*pow(0.17862041985779245,2)),2) + 0.024885196861219643*pow((1.6094830164164176 + 5.475109967288809*xipone + 0.09300584100172837*(16*xipone + 32*xippone))*(1.0711987793749698 + 0.17862041985779245*(1 - 2*etaone) + (l1one - l4one)*pow(0.17862041985779245,2)) + (0.6843887459111011 + 0.744046728013827*xipone)*(0.03218802151990908 - 1.6747086498768822*chi3pone - 2.857926717724679*(2*chi2one - 6*chi3pone + etapone) + 8*(l1pone - l4pone)*pow(0.17862041985779245,2)) + 0.09300584100172837*(-0.1851480494207603 - 3.3494172997537643*(chi3pone + 2*chi3ppone) - 5.715853435449358*(2*chi2one + 8*chi2pone - 6*chi3pone - 12*chi3ppone + etapone + 2*etappone) + 16*(l1pone + 2*l1ppone - l4pone - 2*l4ppone)*pow(0.17862041985779245,2)),2),
                0.00011131839343464602*pow(1.1974845539241097 + 0.05233464530865257*(1 + 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2),2) + 0.000018381891618232285*pow(2.9368143497470225 + 2.758675717499152*l2one*pow(0.17862041985779245,2) - 1.2467634633278375*l5one*pow(0.17862041985779245,2),2) + 0.00011131839343464602*pow(1.0711987793749698 + 0.17862041985779245*(1 + 2*etaone) + (l2one + l5one - 2*l6one)*pow(0.17862041985779245,2),2) + 9.190945809116143e-6*pow(2.9368143497470225 + 0.31489697929184823*etaone + 2.758675717499152*l2one*pow(0.17862041985779245,2) + 1.2467634633278375*l5one*pow(0.17862041985779245,2) - 2.493526926655675*l6one*pow(0.17862041985779245,2),2) + 0.0011764410635668663*pow(3.0633889658297986 - 2.548520520432424*chi3pone + 2.9368143497470225*xipone + 2.872138398363049*l2one*pow(0.17862041985779245,2) + 2.758675717499152*l2pone*pow(0.17862041985779245,2) - 1.298042098237697*l5one*pow(0.17862041985779245,2) - 1.2467634633278375*l5pone*pow(0.17862041985779245,2) + 2.758675717499152*l2one*xipone*pow(0.17862041985779245,2) - 1.2467634633278375*l5one*xipone*pow(0.17862041985779245,2),2) + 0.0005882205317834331*pow(3.0633889658297995 + 2.548520520432424*chi2one - 2.548520520432424*chi3pone + 0.32784850354667666*etaone + 0.31489697929184823*etapone + 2.936814349747022*xipone + 0.31489697929184823*etaone*xipone + 2.8721383983630497*l2one*pow(0.17862041985779245,2) + 2.7586757174991514*l2pone*pow(0.17862041985779245,2) + 2.7586757174991514*l3one*pow(0.17862041985779245,2) + 1.298042098237697*l5one*pow(0.17862041985779245,2) + 1.2467634633278375*l5pone*pow(0.17862041985779245,2) - 3.842847659803231*l6one*pow(0.17862041985779245,2) - 2.493526926655675*l6pone*pow(0.17862041985779245,2) + 2.7586757174991514*l2one*xipone*pow(0.17862041985779245,2) + 1.2467634633278375*l5one*xipone*pow(0.17862041985779245,2) - 2.493526926655675*l6one*xipone*pow(0.17862041985779245,2),2) + 0.18576299474007757*pow(0.6653295973178268 - 2.094852157390034*chi3pone - 0.8112479489468829*chi3ppone + 2.4177079564976083*xipone - 1.6224958978937658*chi3pone*xipone + 0.934850082064787*xippone + 0.6263083175108694*l2one*pow(0.17862041985779245,2) + 2.2675971144866565*l2pone*pow(0.17862041985779245,2) + 0.8781447901588905*l2ppone*pow(0.17862041985779245,2) - 0.2830554972799635*l5one*pow(0.17862041985779245,2) - 1.024824053786403*l5pone*pow(0.17862041985779245,2) - 0.3968711628325456*l5ppone*pow(0.17862041985779245,2) + 2.2675971144866565*l2one*xipone*pow(0.17862041985779245,2) + 1.756289580317781*l2pone*xipone*pow(0.17862041985779245,2) - 1.024824053786403*l5one*xipone*pow(0.17862041985779245,2) - 0.7937423256650912*l5pone*xipone*pow(0.17862041985779245,2) + 0.8781447901588905*l2one*xippone*pow(0.17862041985779245,2) - 0.3968711628325456*l5one*xippone*pow(0.17862041985779245,2),2) + 0.09288149737003881*pow(0.665329597317827 + 2.0948521573900325*chi2one + 1.622495897893765*chi2pone - 2.0948521573900334*chi3pone - 0.8112479489468828*chi3ppone + 0.07149176542878428*etaone + 0.25884139881801055*etapone + 0.10023836438905168*etappone + 2.417707956497608*xipone + 1.622495897893765*chi2one*xipone - 1.6224958978937656*chi3pone*xipone + 0.2588413988180106*etaone*xipone + 0.20047672877810335*etapone*xipone + 0.9348500820647869*xippone + 0.10023836438905168*etaone*xippone + 0.6263083175108696*l2one*pow(0.17862041985779245,2) + 2.267597114486656*l2pone*pow(0.17862041985779245,2) + 0.8781447901588904*l2ppone*pow(0.17862041985779245,2) + 2.267597114486655*l3one*pow(0.17862041985779245,2) + 1.7562895803177798*l3pone*pow(0.17862041985779245,2) + 0.28305549727996343*l5one*pow(0.17862041985779245,2) + 1.0248240537864026*l5pone*pow(0.17862041985779245,2) + 0.3968711628325456*l5ppone*pow(0.17862041985779245,2) - 1.5909350483463294*l6one*pow(0.17862041985779245,2) - 2.843390433237896*l6pone*pow(0.17862041985779245,2) - 0.7937423256650912*l6ppone*pow(0.17862041985779245,2) + 2.267597114486656*l2one*xipone*pow(0.17862041985779245,2) + 1.7562895803177807*l2pone*xipone*pow(0.17862041985779245,2) + 1.7562895803177798*l3one*xipone*pow(0.17862041985779245,2) + 1.0248240537864026*l5one*xipone*pow(0.17862041985779245,2) + 0.7937423256650912*l5pone*xipone*pow(0.17862041985779245,2) - 2.843390433237896*l6one*xipone*pow(0.17862041985779245,2) - 1.5874846513301824*l6pone*xipone*pow(0.17862041985779245,2) + 0.8781447901588904*l2one*xippone*pow(0.17862041985779245,2) + 0.3968711628325456*l5one*xippone*pow(0.17862041985779245,2) - 0.7937423256650912*l6one*xippone*pow(0.17862041985779245,2),2) + 0.027261049494251476*pow((0.5322392241805594 + 0.5112133261002769*xipone)*(1.1974845539241097 + 0.05233464530865257*(1 + 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + 0.06390166576253462*(0.03218802151990908 - 5.715853435449358*chi3pone + 0.8373543249384411*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)),2) + 0.027261049494251476*pow((1.458425361043558 + 4.257913793444475*xipone + 0.06390166576253462*(16*xipone + 32*xippone))*(1.1974845539241097 + 0.05233464530865257*(1 + 2*etaone) + (l2one - l5one)*pow(0.17862041985779245,2)) + (0.5322392241805594 + 0.5112133261002769*xipone)*(0.03218802151990908 - 5.715853435449358*chi3pone + 0.8373543249384411*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone - l5pone)*pow(0.17862041985779245,2)) + 0.06390166576253462*(-0.1851480494207603 - 11.431706870898717*(chi3pone + 2*chi3ppone) + 1.6747086498768822*(2*chi2one + 8*chi2pone - 2*chi3pone - 4*chi3ppone + etapone + 2*etappone) + 16*(l2pone + 2*l2ppone - l5pone - 2*l5ppone)*pow(0.17862041985779245,2)),2) + 0.027261049494251476*pow((0.5322392241805594 + 0.5112133261002769*xipone)*(1.0711987793749698 + 0.17862041985779245*(1 + 2*etaone) + (l2one + l5one - 2*l6one)*pow(0.17862041985779245,2)) + 0.06390166576253462*(0.03218802151990908 - 1.6747086498768822*chi3pone + 2.857926717724679*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone + l3one + l5pone - l6one - 2*l6pone)*pow(0.17862041985779245,2)),2) + 0.027261049494251476*pow((1.458425361043558 + 4.257913793444475*xipone + 0.06390166576253462*(16*xipone + 32*xippone))*(1.0711987793749698 + 0.17862041985779245*(1 + 2*etaone) + (l2one + l5one - 2*l6one)*pow(0.17862041985779245,2)) + (0.5322392241805594 + 0.5112133261002769*xipone)*(0.03218802151990908 - 1.6747086498768822*chi3pone + 2.857926717724679*(2*chi2one - 2*chi3pone + etapone) + 8*(l2pone + l3one + l5pone - l6one - 2*l6pone)*pow(0.17862041985779245,2)) + 0.06390166576253462*(-0.1851480494207603 - 3.3494172997537643*(chi3pone + 2*chi3ppone) + 5.715853435449358*(2*chi2one + 8*chi2pone - 2*chi3pone - 4*chi3ppone + etapone + 2*etappone) + 16*(l2pone + 2*l2ppone + l3one + 4*l3pone + l5pone + 2*l5ppone - l6one - 6*l6pone - 4*l6ppone)*pow(0.17862041985779245,2)),2),
            };

            double result = 0.0;
            for (const auto & b : weak_bounds)
            {
                result += b;
            }

            if (result < 0.0)
            {
                throw InternalError("Contribution to 1^- unitarity bound must be positive; found to be negative!");
            }
            else if ((0.0 <= result) && (result < 1.0))
            {
                return 0.0;
            }
            else
            {
                static const double sigma2 = 0.51 / 3.73; // cf. [CLN1997], eq. (10), p.6
                return -pow((result - 1.0), 2) / sigma2 / 2.0;
            }
        }
        // }}}
    };

    HQETUnitarityBounds::HQETUnitarityBounds(const Parameters & p, const Options & o) :
        PrivateImplementationPattern<HQETUnitarityBounds>(new Implementation<HQETUnitarityBounds>(p, o, *this))
    {
    }

    HQETUnitarityBounds::~HQETUnitarityBounds() = default;

    double
    HQETUnitarityBounds::bound_0p() const
    {
        return _imp->bound_0p();
    }

    double
    HQETUnitarityBounds::bound_0m() const
    {
        return _imp->bound_0m();
    }

    double
    HQETUnitarityBounds::bound_1p() const
    {
        return _imp->bound_1p();
    }

    double
    HQETUnitarityBounds::bound_1m() const
    {
        return _imp->bound_1m();
    }
}
